# $Id: check_common_fn.in,v 1.3 2003/09/07 18:10:55 rocky Exp $
# Common routines and setup for regression testing.
SKIP_TEST_EXITCODE=77

# Some output changes depending on TZ and locale. Set this so we get known
# results
TZ=CUT
LC_TIME='en_US'
export TZ LC_TIME

check_result() {
  RC=$1
  shift
  msg=$*
  if test $RC -ne 0 ; then 
    if test $RC -ne $SKIP_TEST_EXITCODE ; then
      echo "$0: $msg failed."
      exit $RC
    else 
      echo "$0: $msg skipped."
    fi
  else 
    echo "$0: $msg ok."
  fi
}

test_cdinfo() {

  opts="$1"
  outfile="$2"
  rightfile="$3"

  CDINFO="../src/cd-info"

  if [ ! -x ${CDINFO} ]; then
    echo "$0: No ${CDINFO}"
    return 1
  fi

  if ${CDINFO} --no-header ${opts} >${outfile} 2>&1 ; then 
    if test "@DIFF@" != no; then
      if @DIFF@ @DIFF_OPTS@ ${outfile} ${rightfile} ; then
	rm -f $outfile
	return 0
      else
	return 3
      fi
    else
      echo "$0: No diff(1) or cmp(1 found - cannot test ${CDINFO}"
      rm -f $outfile
      return 77
    fi
  else
    echo "$0: ${CDINFO} ${opts} failed"
    return 2
  fi

}

#;;; Local Variables: ***
#;;; mode:shell-script ***
#;;; eval: (sh-set-shell "bash") ***
#;;; End: ***
